<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>CL dev JCT</title>
    <meta name="description" content="">
    <meta name="author" content="Cottage Labs">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!--<link href="/static/favicon.ico" rel="icon" type="image/x-icon">-->

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!--
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <script type="text/javascript" src="/static/moment.min.js"></script>
    -->

    <!--
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mini.css/3.0.1/mini-default.min.css">

    <link href="../static/style.css" rel='stylesheet' type='text/css'>

    <script type="text/javascript" src="../static/jct.js"></script>
    <script type="text/javascript" src="../static/contact.js"></script>

    <script>
        let st = undefined;
        let ft = document.getElementById('funder');
        _ready = () => {
            ft = document.getElementById('funder');
            if (ft !== null) {
                clearInterval(st);
                console.log(ft);
                console.log('ready');
            } else {
                console.log('not ready')
            }
        }
        if (ft === null) st = setInterval(_ready,100);
    </script>
</head>

<body class="container">
<div class="row">
    <a href="/" class="logo col-sm-10">(CL dev) JCT</a>
    <a id="mobmenu" href="#" class="col-sm-1 hidden-md hidden-lg" style="padding-top:5px;font-size:2em;"><span class="icon-help"></span></a>
</div>
<main id="main" class="container">
    <div id="plugin"></div>
    <div id="spacer" class="row hidden-sm" style="margin-top:25%;"></div>
</main>
<!-- <other_options></other_options> -->
<div class="section" id="section_apply" style="display: none">
    <p>TODO add an application form for transformative journals here, and a bulk upload csv mechanism, with example csv file showing necessary format</p>
    <p>Also link to explanations on plan-s site of what transformative journal is</p>
    <p>And link to our own page here listing all transformative jouranls already known</p>
</div>
<div class="section" id="section_notify" style="display: none">
    <p>TODO add a notify form so publishers/journals, or users, can notify us of changes to tranformative agreements, or other fixes</p>
</div>
<div class="section" id="section_journals" style="display: none">
    <p>TODO list all transformative journals here, and link to explanations on plan-s site of what a transformative journal is.</p>
    <p>Job of data manager will include ensuring the applications we receive are processed and approved in the system, and reviewing in line with plan-s reqs.</p>
</div>
<div class="section" id="section_agreements" style="display: none">
    <p>TODO list all transformative agreements here, and link to explanations on plan-s site of what a transformative agreement is.</p>
    <p>Also could allow filtering by institution, to see what agreements your institution is signed up to</p>
    <p>Job of data manager will include listing out which institutions are related to which ESAC agreement, which we will store in sheets / backend.</p>
    <p>And link to ESAC here, probably recommend them as first place to go to register any new agreements - and maybe have a way for people to let us know directly?</p>
    <p><a href="https://esac-initiative.org/about/transformative-agreements/share/">ESAC transformative agreements registration link</a></p>
</div>
<div class="section" id="section_about" style="display: none">
    <p>TODO an about page decsribing the JCT and why it exists</p>

    <p>Which will also contain a blurb about plan-s and why they exist, why they made this</p>
    <p>And link to plan-s / coalition-s site for more info</p>
</div>
<div class="section" id="section_howto" style="display: none">
    <p>TODO a click-through walkthrough thing of how to use the service</p>
    <p>And also add an FAQ, which may best be generated from a sheet that the data manager can use to answer questions, then feed them in here automatically.</p>
</div>
<div class="section" id="section_embed" style="display: none">
    <p>TODO an explanation of embedding the tool on your own site, for journal, funder, institution, with link to embed code</p>
    <p>And how to customise it to set your journal/funder already because no point a user selecting that when already on the website of that entity.</p>
</div>
<div class="section" id="section_feedback" style="display: none">
    <div class="container" id="contact">
        <form onsubmit="send_feedback()" id="contact_form">

            <label for="name">Name</label>
            <input type="text" id="name" name="firstname" placeholder="Your name..">

            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="Your email..">

            <label for="message">Your message</label>
            <textarea id="message" name="message" placeholder="Write something.."></textarea>

            <input type="submit" value="Submit">

        </form>
    </div>
</div>
</div>

<div class="row">
    <div class="col-sm">
        <p>
            <button type="button" id="apply" class="button primary small bordered pager">Apply for transformative journal status </button>  <button type="button" id="notify" class="button small bordered pager" >Notify us of changes </button><br>
            <button type="button" id="journals" class="button small bordered pager">Transformative journals </button>  <button type="button" id="agreements" class="button small bordered pager" >Transformative agreements </button>
        </p>
    </div>
    <div class="col-sm">
        <p style="text-align:right;">
            <button type="button" id="about" class="button small bordered pager">About this service </button>  <button type="button" id="about_plans" class="button small bordered pager" >About Plan S / cOAlition S </button><br>
            <button type="button" id="howto" class="button small bordered pager">How to use this service </button>  <button type="button" id="embed" class="button small bordered pager" >Use on your site </button>
            <button type="button" id="feedback" class="button small bordered pager">Give us feedback </button>
        </p>
    </div>
</div>

</body>

<script>

    jct.setup();

    jct.d.gebi('mobmenu').addEventListener("click", function(e) {
        e.preventDefault();
        scroll(0,document.body.scrollHeight);
    });


    jct.d.each('pager', (el) => {
        el.addEventListener("click", (e) => {
            e.preventDefault();
            jct.d.each('section', (el) => {
                el.style.display = 'none';
            });
            jct.d.gebi('spacer').style.display = 'none';
            scroll(0, 0);
            let sid = el.getAttribute('id').split('_')[0];
            jct.d.gebi('section_' + sid).style.display = 'block';
            // TODO also alter the page URL bar and back/forward methods to show the right routes and sections
            // TODO and on first show, get the content for the section from backend, so that initial page load stays fast
            if (sid === 'agreements') {
                if (!jct.d.gebi('agreements_table')) {
                    jct.jx('transformative/esac', undefined, (xhr) => {
                        let data = JSON.parse(xhr.response);
                        console.log(xhr.response)
                        let table = '<table id="agreements_table">';
                        table += '<thead><tr><th>publisher</th><th>country</th><th>customer</th><th>size</th><th>start date</th><th>end date</th><th>ID</th></tr></thead><tbody>';
                        for (let r in data) {
                            table += '<tr>';
                            for (let d in data[r]) {
                                console.log(d)
                                if (['publisher', 'country', 'customer', 'size', 'start_date', 'end_date', 'id'].indexOf(d) !== -1) {
                                    table += '<td>' + data[r][d] + '</td>';
                                }
                            }
                            table += '</tr>';
                        }
                        table += '</tbody>';
                        table += '</table>';
                        jct.d.gebi('section_agreements').innerHTML = jct.d.gebi('section_agreements').innerHTML + '<br>' + table;
                    });
                }
            }
        });
    });
</script>

</html>